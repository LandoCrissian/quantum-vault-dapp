<!-- Quantum Vault ‚Äì Locked-In, Polished Homepage -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quantum Vault ‚Äì Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Space Grotesk', sans-serif;
    }
    body {
      background: #000;
      color: #fff;
      padding: 16px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding-bottom: 100px;
    }
    .section {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 20px;
      backdrop-filter: blur(14px);
    }
    .title {
      font-size: 20px;
      color: #00ffe1;
      margin-bottom: 12px;
    }
    .wallet {
      font-size: 13px;
      color: #aaa;
      margin-bottom: 8px;
      word-break: break-word;
    }
    .badge {
      display: inline-block;
      background: #00ffe1;
      color: #000;
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 6px;
      margin: 6px 4px;
      font-weight: bold;
    }
    .player-badge {
      display: flex;
      align-items: center;
      background: #111;
      border-radius: 14px;
      padding: 12px;
      margin-top: 10px;
      border: 2px solid #00ffe1;
      cursor: pointer;
    }
    .player-badge img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 12px;
      border: 2px solid inherit;
    }
    .badge-info {
      display: flex;
      flex-direction: column;
    }
    .badge-info .nickname { color: #00ffe1; font-weight: bold; }
    .badge-info .handle { color: #ccc; font-size: 12px; }
    .badge-stats { font-size: 11px; color: #aaa; margin-top: 4px; }
        .balance-badges {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal-content {
      background: #111;
      padding: 24px;
      border-radius: 14px;
      width: 90%;
      max-width: 360px;
      text-align: left;
      color: #fff;
      box-shadow: 0 0 10px #00ffe1;
    }
    .modal-content h2 {
      color: #00ffe1;
      margin-bottom: 16px;
      font-size: 18px;
    }
    .modal-content label {
      font-size: 12px;
      margin-top: 10px;
      display: block;
      color: #aaa;
    }
    .modal-content input[type="text"],
    .modal-content input[type="color"] {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      background: #000;
      border: 1px solid #444;
      color: #00ffe1;
      margin-top: 4px;
    }
    .modal-actions {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
    }
    .modal-actions button {
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    .modal-actions .save {
      background: #00ffe1;
      color: #000;
    }
    .modal-actions .cancel {
      background: #333;
      color: #fff;
    }
    .player-badge {
  position: relative;
}

.player-badge svg {
  position: absolute;
  top: 10px;
  right: 10px;
}
  </style>
</head>
<body>
  <div class="container">
    <div class="section">
      <div class="title">Welcome Back</div>
      <div id="walletDisplay" class="wallet">Connecting...</div>
      <div class="player-badge" id="playerBadge">
  <!-- White ùïè icon top right -->
  <div onclick="shareBadge()" title="Share on ùïè" style="position:absolute; top:10px; right:10px;">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff" xmlns="http://www.w3.org/2000/svg" style="cursor:pointer;">
      <path d="M19.633 7.997c.013.18.013.361.013.542 0 5.524-4.205 11.894-11.893 11.894-2.365 0-4.567-.692-6.414-1.876.33.038.648.051.991.051a8.412 8.412 0 005.215-1.798 4.194 4.194 0 01-3.917-2.91c.256.038.499.063.768.063.368 0 .736-.051 1.08-.14a4.186 4.186 0 01-3.361-4.105v-.051a4.21 4.21 0 001.894.53 4.197 4.197 0 01-1.873-3.491c0-.768.204-1.473.56-2.086a11.897 11.897 0 008.627 4.37 4.719 4.719 0 01-.102-.961 4.194 4.194 0 017.257-2.868 8.286 8.286 0 002.668-1.02 4.196 4.196 0 01-1.84 2.314 8.373 8.373 0 002.404-.648 8.837 8.837 0 01-2.092 2.153z"/>
    </svg>
  </div>

  <img id="badgePFP" src="https://api.dicebear.com/6.x/pixel-art/svg?seed=anon" alt="PFP" />
  <div class="badge-info">
    <div class="nickname" id="badgeNickname">anon</div>
    <div class="handle" id="badgeHandle">ùïè: @handle</div>
    <div class="badge-stats">
      <span id="badgeGames">Games: 0</span>
      <span id="badgeWins">Wins: 0</span>
      <span id="badgeY2K">Y2K: 0</span>
    </div>
  </div>
</div>
      
      <div class="balance-badges">
        <div id="y2kBalance" class="badge">Y2K: 0</div>
        <div id="croBalance" class="badge">CRO: 0</div>
      </div>
    </div>
    
    <div class="section">
      <div class="title">Latest Announcement</div>
      <div id="latestAnnouncement">Loading...</div>
    </div>

    <div class="section">
      <div class="title">MVP Spotlight</div>
      <div id="mvpUser">@unknown</div>
      <div class="wallet" id="mvpEarnings">0 Y2K Earned</div>
    </div>

    <div class="section">
      <div class="title">New Players (Last 48h)</div>
      <div id="newPlayers">Loading...</div>
    </div>

    <!-- Vault Chat Room -->
<div class="section">
  <div class="title">Vault Chat Room</div>
  <div id="chatBox" style="max-height: 220px; overflow-y: auto; font-size: 13px; background:#111; padding:12px; border-radius:10px; margin-bottom:12px;"></div>
  <div style="display:flex; gap:8px;">
    <input type="text" id="chatInput" placeholder="Type your message..." style="flex:1; padding:10px; border-radius:8px; border:1px solid #444; background:#000; color:#00ffe1;">
    <button id="sendMsgBtn" style="padding:10px 16px; border:none; border-radius:8px; background:#00ffe1; color:#000; font-weight:bold;">Send</button>
  </div>
</div>
    

    <div class="modal" id="badgeModal">
      <div class="modal-content">
        <h2>Edit Player Badge</h2>
        <label for="editNickname">Nickname</label>
        <input type="text" id="editNickname" placeholder="Enter nickname" />
        <label for="editHandle">ùïè Handle</label>
        <input type="text" id="editHandle" placeholder="@handle" />
        <label for="editRimColor">Badge Rim Color</label>
        <input type="color" id="editRimColor" value="#00ffe1" />
        <div class="modal-actions">
          <button class="save" id="saveBadgeBtn">Save</button>
          <button class="cancel" id="cancelBadgeBtn">Cancel</button>
        </div>
      </div>
    </div>

    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import {
  getFirestore, doc, getDoc, setDoc, collection, getDocs, query,
  orderBy, limit, where, onSnapshot, addDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCJwqDFZtf1PkZwAalOaf2_7eWtej5HIfA",
  authDomain: "y2k-arcade.firebaseapp.com",
  projectId: "y2k-arcade",
  storageBucket: "y2k-arcade.appspot.com",
  messagingSenderId: "1063043176357",
  appId: "1:1063043176357:web:20bc22e9cbf269ff40fa4c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let currentWallet = "";

async function connectWalletAndLoad() {
  if (!window.ethereum) {
    alert("Please install MetaMask");
    return;
  }

  const provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  const signer = provider.getSigner();
  currentWallet = (await signer.getAddress()).toLowerCase();

  const short = `${currentWallet.slice(0, 6)}...${currentWallet.slice(-4)}`;
  document.getElementById("walletDisplay").textContent = "Welcome back: " + short;

  const userSnap = await getDoc(doc(db, "users", currentWallet));
  if (userSnap.exists()) {
    const data = userSnap.data();
    document.getElementById("badgePFP").src = data.pfpUrl || `https://api.dicebear.com/6.x/pixel-art/svg?seed=anon`;
    document.getElementById("badgeNickname").textContent = data.username || "anon";
    document.getElementById("badgeHandle").textContent = data.xHandle ? `ùïè: @${data.xHandle}` : "ùïè: N/A";
    document.getElementById("badgeY2K").textContent = `Y2K: ${data.earnings || 0}`;
    document.getElementById("badgeGames").textContent = `Games: ${data.games || 0}`;
    document.getElementById("badgeWins").textContent = `Wins: ${data.wins || 0}`;

    if (data.badgeColor) {
      document.getElementById("playerBadge").style.borderColor = data.badgeColor;
      document.getElementById("editRimColor").value = data.badgeColor;
    }

    document.getElementById("editNickname").value = data.username || "";
    document.getElementById("editHandle").value = data.xHandle || "";
  }

  try {
    const croBal = await provider.getBalance(currentWallet);
    const cro = parseFloat(ethers.utils.formatEther(croBal)).toFixed(2);
    document.getElementById("croBalance").textContent = `CRO: ${cro}`;
  } catch {
    document.getElementById("croBalance").textContent = "CRO: --";
  }

  try {
    const y2kContract = new ethers.Contract(
      "0xB4Df7d2A736Cc391146bB0dF4277E8F68247Ac6d",
      ["function balanceOf(address) view returns (uint256)"],
      provider
    );
    const raw = await y2kContract.balanceOf(currentWallet);
    const bal = parseFloat(ethers.utils.formatUnits(raw, 18)).toFixed(2);
    document.getElementById("y2kBalance").textContent = `Y2K: ${bal}`;
  } catch {
    document.getElementById("y2kBalance").textContent = "Y2K: --";
  }
}

async function loadMVP() {
  const topSnap = await getDocs(query(collection(db, "users"), orderBy("earnings", "desc"), limit(1)));
  if (!topSnap.empty) {
    const top = topSnap.docs[0].data();
    document.getElementById("mvpUser").textContent = "@" + (top.username || "anon");
    document.getElementById("mvpEarnings").textContent = `${top.earnings || 0} Y2K Earned`;
  }
}

async function loadNewPlayers() {
  const cutoff = Date.now() - (48 * 60 * 60 * 1000);
  const q = query(collection(db, "users"), where("createdAt", ">", cutoff));
  const snap = await getDocs(q);
  const box = document.getElementById("newPlayers");
  box.innerHTML = snap.empty ? "No new users yet." : "";
  snap.forEach(doc => {
    const u = doc.data();
    const tag = document.createElement("div");
    tag.className = "badge";
    tag.textContent = "@" + (u.username || "anon");
    box.appendChild(tag);
  });
}

document.getElementById("playerBadge").addEventListener("click", () => {
  document.getElementById("badgeModal").style.display = "flex";
});

document.getElementById("cancelBadgeBtn").addEventListener("click", () => {
  document.getElementById("badgeModal").style.display = "none";
});

document.getElementById("saveBadgeBtn").addEventListener("click", async () => {
  const nickname = document.getElementById("editNickname").value.trim();
  const handle = document.getElementById("editHandle").value.trim();
  const rimColor = document.getElementById("editRimColor").value;

  await setDoc(doc(db, "users", currentWallet), {
    username: nickname,
    xHandle: handle,
    badgeColor: rimColor
  }, { merge: true });

  document.getElementById("badgeNickname").textContent = nickname;
  document.getElementById("badgeHandle").textContent = handle ? `ùïè: @${handle}` : "ùïè: N/A";
  document.getElementById("playerBadge").style.borderColor = rimColor;
  document.getElementById("badgeModal").style.display = "none";
});

// CHAT: Real-time listener
const chatRef = collection(db, "chat");
onSnapshot(query(chatRef, orderBy("timestamp", "asc"), limit(100)), (snap) => {
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  snap.forEach(doc => {
    const m = doc.data();
    const msg = document.createElement("div");
    msg.innerHTML = `<strong style="color:#00ffe1;">@${m.name || "anon"}:</strong> ${m.text}`;
    box.appendChild(msg);
  });
  box.scrollTop = box.scrollHeight;
});

// CHAT: Send message
document.getElementById("sendMsgBtn").addEventListener("click", async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  const name = document.getElementById("badgeNickname").textContent?.replace(/^@/, "") || "anon";

  await addDoc(collection(db, "chat"), {
    name,
    text,
    timestamp: serverTimestamp()
  });

  input.value = "";
});

connectWalletAndLoad();
loadMVP();
loadNewPlayers();

      function shareBadge() {
  const nickname = document.getElementById("badgeNickname").textContent.replace(/^@/, "") || "anon";
  const earnings = document.getElementById("badgeY2K").textContent.replace("Y2K: ", "") || "0";
  const wins = document.getElementById("badgeWins").textContent.replace("Wins: ", "") || "0";
  const games = document.getElementById("badgeGames").textContent.replace("Games: ", "") || "0";
  const url = "https://y2kcoin.org";
  const tags = "#CROFAM #puushfuncronos #Y2KCoin #Y2KxROAST";

  const postTemplates = [
    `I just minted my badge in the Quantum Vault. Games played: ${games}, Wins: ${wins}, Y2K earned: ${earnings}.`,
    `Verified in the Quantum Vault. Stats ‚Äî Wins: ${wins}, Games: ${games}, Y2K: ${earnings}. Join us.`,
    `Badge locked. Stats tracked. I'm in. Wins: ${wins}, Games: ${games}, $Y2K: ${earnings}.`,
    `Badge flexed. Quantum Vault open. Games: ${games} | Wins: ${wins} | Y2K: ${earnings}.`,
    `I didn‚Äôt just join. I activated. Vault stats ‚Äî ${wins} wins, ${games} games, ${earnings} Y2K.`,
    `Quantum Vault stats: ${games} games, ${wins} wins, ${earnings} Y2K. Badge secured.`,
    `Minted identity. Quantum Vault stats: Y2K ${earnings}, Wins ${wins}, Games ${games}.`,
    `Live inside the Quantum Vault. ${wins} wins. ${games} battles. ${earnings} Y2K to show.`,
    `It‚Äôs not a badge. It‚Äôs a record. ${games} games. ${wins} wins. ${earnings} Y2K earned.`,
    `I'm early, and I‚Äôve got the badge to prove it. ${games} games | ${wins} wins | ${earnings} Y2K.`
  ];

  const randomText = postTemplates[Math.floor(Math.random() * postTemplates.length)];
  const fullTweet = encodeURIComponent(`${randomText}\n\n‚Üí ${url}\n${tags}`);
  const shareUrl = `https://twitter.com/intent/tweet?text=${fullTweet}`;
  window.open(shareUrl, '_blank');
}

window.shareBadge = shareBadge;
      
</script>
</body>
</html>
