<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Quantum Vault ‚Äì Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #000; --text: #fff; --accent: #00ffe1;
      --panel: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.08);
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Space Grotesk', sans-serif;
    }
    body {
      background: var(--bg); color: var(--text);
      overflow-x: hidden; padding: 0;
    }
    header {
      display: flex; justify-content: space-between;
      align-items: center; padding: 16px;
      border-bottom: 1px solid var(--border);
      background: #000;
    }
    .logo {
      font-size: 18px; font-weight: bold;
      color: var(--accent);
    }
    .hamburger {
      width: 26px; height: 18px;
      position: relative; cursor: pointer;
    }
    .hamburger span {
      position: absolute; height: 2px; width: 100%;
      background: #fff; left: 0;
      transition: 0.3s ease;
    }
    .hamburger span:nth-child(1) { top: 0; }
    .hamburger span:nth-child(2) { top: 8px; }
    .hamburger span:nth-child(3) { top: 16px; }
    .sidebar {
      position: fixed; top: 0; left: -240px;
      width: 240px; height: 100%;
      background: #111; border-right: 1px solid var(--border);
      padding: 24px; transition: left 0.3s ease;
      z-index: 999;
    }
    .sidebar.active { left: 0; }
    .sidebar a {
      display: block; color: var(--accent);
      margin: 16px 0; text-decoration: none;
      font-size: 15px;
    }
    .main {
      padding: 16px;
    }
    .section {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }
    .title {
      font-size: 18px; color: var(--accent);
      margin-bottom: 10px;
    }
    .wallet-info {
      font-size: 14px; color: #aaa;
      margin-bottom: 8px;
    }
    .balance-badges {
      display: flex; gap: 10px; flex-wrap: wrap;
      justify-content: center; margin-top: 10px;
    }
    .badge {
      background: var(--accent);
      color: #000; padding: 6px 14px;
      font-size: 13px; border-radius: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <a href="#">Home</a>
    <a href="#">Games</a>
    <a href="#">Leaderboard</a>
    <a href="#">Partners</a>
    <a href="#">Profile</a>
  </div>

  <header>
    <div class="logo">Quantum Vault</div>
    <div class="hamburger" onclick="toggleSidebar()">
      <span></span><span></span><span></span>
    </div>
  </header>

  <div class="main">
    <div class="section">
      <div class="title">Welcome Back</div>
      <div id="walletDisplay" class="wallet-info">Connecting wallet...</div>
      <div class="balance-badges">
        <div id="y2kBalance" class="badge">Y2K: 0</div>
        <div id="croBalance" class="badge">CRO: 0</div>
      </div>
    </div>

    <div class="section">
      <div class="title">Latest Announcement</div>
      <div id="announcementBox">Loading...</div>
    </div>

    <div class="section">
      <div class="title">MVP Spotlight</div>
      <div id="mvpUser">@unknown</div>
      <div class="wallet-info" id="mvpEarnings">0 Y2K Earned</div>
    </div>

        <div class="section">
      <div class="title">New Players (Last 48h)</div>
      <div id="newPlayers">Loading...</div>
    </div>

    <div class="section">
      <div class="title">Partner Projects</div>
      <div id="partnerBox" style="margin-top:10px;"></div>
    </div>

    <div class="section">
      <div class="title">Share Your Vault</div>
      <button onclick="shareToX()" style="margin-top:10px;padding:10px 20px;background:#00ffe1;color:#000;border:none;border-radius:8px;font-weight:bold;">Post to ùïè</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getFirestore, doc, getDoc, collection, getDocs, query, orderBy, limit, where
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCJwqDFZtf1PkZwAalOaf2_7eWtej5HIfA",
      authDomain: "y2k-arcade.firebaseapp.com",
      projectId: "y2k-arcade",
      storageBucket: "y2k-arcade.appspot.com",
      messagingSenderId: "1063043176357",
      appId: "1:1063043176357:web:20bc22e9cbf269ff40fa4c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const y2kAddress = "0xB4Df7d2A736Cc391146bB0dF4277E8F68247Ac6d";

    async function connectWalletAndFetch() {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      const signer = provider.getSigner();
      const wallet = (await signer.getAddress()).toLowerCase();

      document.getElementById("walletDisplay").textContent = wallet.slice(0, 6) + "..." + wallet.slice(-4);

      const y2kContract = new ethers.Contract(y2kAddress, ["function balanceOf(address) view returns (uint256)"], provider);
      const y2kRaw = await y2kContract.balanceOf(wallet);
      const y2k = parseFloat(ethers.utils.formatUnits(y2kRaw, 18)).toFixed(2);
      document.getElementById("y2kBalance").textContent = `Y2K: ${y2k}`;

      const cro = await provider.getBalance(wallet);
      const croVal = parseFloat(ethers.utils.formatEther(cro)).toFixed(2);
      document.getElementById("croBalance").textContent = `CRO: ${croVal}`;
    }

    async function loadMVP() {
      const topQuery = query(collection(db, "users"), orderBy("earnings", "desc"), limit(1));
      const snap = await getDocs(topQuery);
      if (!snap.empty) {
        const data = snap.docs[0].data();
        document.getElementById("mvpUser").textContent = "@" + (data.username || "unknown");
        document.getElementById("mvpEarnings").textContent = `${data.earnings || 0} Y2K Earned`;
      }
    }

    async function loadAnnouncement() {
      const ref = doc(db, "meta", "announcement");
      const snap = await getDoc(ref);
      if (snap.exists()) {
        document.getElementById("announcementBox").textContent = snap.data().text || "No announcement yet.";
      } else {
        document.getElementById("announcementBox").textContent = "No announcement yet.";
      }
    }

    async function loadNewPlayers() {
      const cutoff = Date.now() - 48 * 60 * 60 * 1000;
      const q = query(collection(db, "users"), where("createdAt", ">", cutoff));
      const snap = await getDocs(q);
      const container = document.getElementById("newPlayers");
      if (snap.empty) {
        container.innerHTML = "<div style='color:#888;'>No new members yet.</div>";
        return;
      }
      container.innerHTML = "";
      snap.forEach(doc => {
        const u = doc.data();
        const tag = document.createElement("div");
        tag.className = "badge";
        tag.textContent = "@" + (u.username || "unknown");
        container.appendChild(tag);
      });
    }

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
    }

    function shareToX() {
      const messages = [
        "Just entered the Quantum Vault ‚Äî and I‚Äôm not leaving empty-handed. #CROFAM #Puushfuncronos",
        "This is your sign to try quantum gambling. I just joined the Vault. #CROFAM #Puushfuncronos",
        "A vault like no other. Risk is the real flex. #QuantumVault #CROFAM #Puushfuncronos",
        "Logged in, locked in, let the draws begin. #CROFAM #Puushfuncronos"
      ];
      const msg = encodeURIComponent(messages[Math.floor(Math.random() * messages.length)]);
      const url = encodeURIComponent("https://quantum-vault-y2kxroast.netlify.app/");
      window.open(`https://twitter.com/intent/tweet?text=${msg}&url=${url}`, "_blank");
    }

    connectWalletAndFetch();
    loadMVP();
    loadAnnouncement();
    loadNewPlayers();

        async function loadPartners() {
      const partners = [
        { name: "DOJO", logo: "https://i.imgur.com/CUZcb5O.png", link: "https://twitter.com/CRODOJO" },
        { name: "CroFighter", logo: "https://i.imgur.com/7gNV9od.png", link: "https://twitter.com/crofighter" },
        { name: "Cards of Cronos", logo: "https://i.imgur.com/o1bHvXN.png", link: "https://twitter.com/CardsofCronos" }
      ];
      const container = document.getElementById("partnerBox");
      partners.forEach(p => {
        const el = document.createElement("div");
        el.style.margin = "8px";
        el.innerHTML = `
          <a href="${p.link}" target="_blank" style="text-decoration:none;">
            <img src="${p.logo}" alt="${p.name}" style="width:40px;height:40px;border-radius:8px;margin-bottom:4px;" /><br/>
            <span style="color:#ccc;font-size:13px;">${p.name}</span>
          </a>
        `;
        container.appendChild(el);
      });
    }

    loadPartners();
  </script>
</body>
</html>
